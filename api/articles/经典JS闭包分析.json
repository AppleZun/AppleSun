{"title":"经典JS闭包分析","slug":"经典JS闭包分析","date":"2017-02-18T05:35:37.000Z","updated":"2017-06-29T01:14:13.611Z","comments":true,"excerpt":"<p>最近 ，在交流群里 有人提出了 一个问题：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">for (var i = 0; i &lt; 10; i++) &#123;</div><div class=\"line\">\tsetTimeout(function () &#123;</div><div class=\"line\">\t\tconsole.log(i)</div><div class=\"line\">\t&#125;,1000)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>记住你的答案，开始查看博客。</p>","content":"<p>最近 ，在交流群里 有人提出了 一个问题：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">for (var i = 0; i &lt; 10; i++) &#123;</div><div class=\"line\">\tsetTimeout(function () &#123;</div><div class=\"line\">\t\tconsole.log(i)</div><div class=\"line\">\t&#125;,1000)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>记住你的答案，开始查看博客。</p>\n<a id=\"more\"></a>\n<p>首先，我们先注意最外层的 for循环，如果忽略 里面的的setTimeot，相信 很多人知道 答案是 <strong>1,2,3,4,5,6,7,8,9</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">for(var i=0;i&lt;10;i++)&#123;</div><div class=\"line\">\tconsole.log(i);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"那么问题来了，加上-这个-setTimeout-难道答案就不是-1到9-了么？\"><a href=\"#那么问题来了，加上-这个-setTimeout-难道答案就不是-1到9-了么？\" class=\"headerlink\" title=\"那么问题来了，加上 这个 setTimeout 难道答案就不是 1到9 了么？\"></a>那么问题来了，加上 这个 setTimeout 难道答案就不是 1到9 了么？</h4><p>放到 chrome 开发者工具跑一下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">for (var i = 0; i &lt; 10; i++) &#123;</div><div class=\"line\">\tsetTimeout(function () &#123;</div><div class=\"line\">\t\tconsole.log(i)</div><div class=\"line\">\t&#125;,1000)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"Excuse-Me，这-结果-居然是-10个10\"><a href=\"#Excuse-Me，这-结果-居然是-10个10\" class=\"headerlink\" title=\"Excuse Me，这 结果 居然是 10个10\"></a>Excuse Me，这 结果 居然是 10个10</h4><p>好吧，然我们来分析一下 这个函数运行的整个过程：通过 chrome 断点调试，一步一步执行函数就会发现一个有趣的现象；</p>\n<p>其实整个函数先执行的是for循环，当i = 10，的时候跳出循环，这个时候才开始执行 setTimeout 的 打印输出</p>\n<p>黄轶解释说：</p>\n<blockquote>\n<p>其实这是一个JS Event Loop的问题，setTimeout里的回调都会再每一次EventLoop中去check，达到时间了就会执行。<br>你这个case中， for循环会在当前Event Loop中执行完毕，i会加到10跳出循环体，setTimeout中所有回调函数都会在之后的Event Loop中执行，所以输出全部都是10</p>\n</blockquote>\n<p>大神解释完其实还是 不懂 为啥就这样的，可以参考 阮一峰老师的 关于浏览器事件的分析：<br><a href=\"http://www.ruanyifeng.com/blog/2014/10/event-loop.html\" target=\"_blank\" rel=\"external\">JavaScript 运行机制详解：再谈Event Loop</a> 和 <a href=\"http://www.ruanyifeng.com/blog/2013/10/event_loop.html\" target=\"_blank\" rel=\"external\">什么事event loop</a></p>\n<p>小伙伴们，看了 这篇 实列分析加上 阮老师的指导对了此类问题明白了么？</p>\n<p><strong>Yours Sincerely AppleSun</strong></p>\n","categories":[],"tags":[{"name":"js","path":"api/tags/js.json"},{"name":"面试题","path":"api/tags/面试题.json"}]}